---
leyout: post
title:  tDiary 1.5.6リリース
categories:
  - release
---
開発版tDiary 1.5.6をリリースしました。

プラグイン選択と国際化対応、ドキュメント用Wikiサイトの利用が主な新機能です。比較的非互換が大きいので、以下の説明をよく読んでからアップデートして下さい。2.0のリリースまで、あと少しです:-)

### 本体
本体に追加されたのは以下の機能です。

* プラグイン選択
  * plugin/01sp.rbプラグインが本体に追加され、misc/pluginの下にあるプラグインファイルを設定画面から選択インストールできるようになりました。これにより、プラグインのインストール方法はファイルのコピーからプラグイン選択に変わるという、大きな仕様変更になります(従来の方法もありますが、次に述べる国際化対応の関係から推奨されません)
  * プラグイン選択用のディレクトリは通常「misc/plugin」になっていますが、オプションで変更可能です。tdiary.conf内で「@options['sp.path']」変数に、パスを指定して下さい。なお、配列を設定することで複数のパスを指定することも可能です
* 国際化対応
  * tdiary.confに「@lang = 'en'」と指定するだけで英語版のtDiaryになります。他の言語に対応することも可能な仕組みを入れました
  * この余波で、多くのプラグインのファイルが「プラグイン本体」と「言語リソース」に分離されています。従来のファイルコピーでプラグインをインストールする場合には、言語リソースを適切な言語用ディレクトリにコピーするのを忘れてはいけません。なお、プラグイン選択を使えばこの手間はなくなります
* ドキュメントWikiサイト開設
  * http://docs.tdiary.org/ja/を開設し、プラグインやスタイルのドキュメントを集積します(まだ中身はあまりありません)。プラグインのドキュメントはプラグイン選択画面から、スタイルのドキュメントは更新画面から参照できます。Wikiを使っているので、まだドキュメントがないページがあったら、どんどん書き込んで下さい
* tdiary.confで指定できる新しいオプション
  * @cache_path: キャッシュファイルを作るディレクトリが指定できます。tdiary.conf内でのみ指定可能です
  * @referrer_day_only: 日別ページを指している「リンク元」のみを記録するようにします。これにより、アンテナ等からのアクセスによるノイズの混入が防げます。なおこれは設定画面からも指定可能です
  * @options['bot']: 検索エンジンの巡回用ロボットを指定できます。ここに指定されたロボットによるアクセスでは、リンク元を見せないなどの検索エンジン向けページを生成します。これはtdiary.confでのみ指定可能です
* その他、バグ修正多数

### プラグイン
* 国際化対応、プラグイン選択対応
  * 本体のところにあるように、国際化の余波で本体から言語リソースが分離しました。これにより、インストール方法としては「プラグイン選択」を使うことを推奨します
  * また、プラグイン選択に対応するため、ファイルの場所が移動したものがいくつかあります(tb-show.rb、tb-send.rbなど)。気をつけてください
* 追加されたプラグイン
  * append-css.rb: テーマにCSSの断片を追加する
  * search_control.rb: 検索エンジンのロボットに、適切なページだけを対象にしてもらう
  * random_google.rb: Googleを使って「関連する(かもしれない)ページ」をリストさせる
  * sn.rb: アンカーに通し番号をつける
  * highlight.rb: 他のページからのアクセス時に、サブタイトルの色を変える
* 削除されたプラグイン
  * referer-utf.rb: 本体に相当機能が加わったため
  * nazo.rb: highlight.rbによって置き変わったため

### テーマ
* ブラウザ間の互換性を大きく向上
  * 従来、フォントサイズやレイアウト指定方法の影響で、ブラウザによっては大きく異なる見栄えになっていました。今回、より多くのブラウザで近い見栄えを実現できるよう、全面的に調整を加えました。ぜひ、いま使っているテーマと置き換えてください
* 追加されたテーマ
  * himawari
  * sepia

### BlogKit
* 国際化対応に追従しました
* 待望のカテゴリ機能が、blog-category.rbプラグインによって実現できました
* title-navi.rbプラグインが、月をまたいで表示するようになりました

### 推奨されるアップデートの手順

1. 配布ファイルをすべて1.5.6のものに置き換えます
2. pluginディレクトリにコピー(またはリンク)してあったファイルはすべて削除します。何を削除したか、メモっておきましょう。削除後にここに残っているのは00default.rbと01sp.rbの2つと、各言語用のディレクトリ(jaとen)およびその下にあるファイルだけにします。英語環境で動かしている場合、00lang.en.rbはもう不要です
3. もし、フルパッケージを使っていない場合、プラグインはmisc/plugin以外のところに入っていると思います。この場合は、tdiary.conf内で「@options['sp.path'] = 'プラグインのディレクトリ'」を指定する必要があります
4. ブラウザからtDiaryにアクセスして、設定画面を開きます。「プラグイン選択」というメニューが加わっていて、それを選ぶとプラグインの一覧から選択できるようになっていればアップデート成功です
5. あらかじめメモっておいた今まで使っていたプラグインを選択し、OKボタンを押して有効にして下さい。なお、プラグインによっては設定画面上からいろいろな設定ができるようになっています。試してみましょう

