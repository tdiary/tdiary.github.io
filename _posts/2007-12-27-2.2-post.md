---
leyout: post
title:  2.2の「本日のリンク元」について
date: 2008-02-29 14:35:59 +0900
categories:
  - 2.2
  - referer
---
**追記(2008-02-29)**: 2.2.1における仕様変更を反映。

先日公開したtDiary 2.2では、「本日のリンク元」の機能が大きく変更されています。

tDiaryは従来、リンク経由のアクセスは基本的にすべて、アクセスのあったその日と最新の日記の両方にリンク元情報を保存していました。常に最新の日付を見ていれば、その日のアクセスによるリンク元情報をすべて見られるようにするためです。しかし、Webの利用が増大し、アクセスの多い日記ではリンク元情報があまりに大きくなりすぎる傾向が出てきました。

このため2.2からは、このような時代の変化に対応するため、リンク元情報を一時的にしか保存しない仕組みや、表示に時間のかかりすぎる部分を省略する対応をしてあります。具体的には以下のような変更をしました:

### リンク元の表示を、日毎ページのみにした
従来、最新、月毎、日毎のすべてのページにてリンク元を表示していましたが、多数の日に渡ってリンク元を表示すると非常に重くなるため、日毎ページのみで表示するようになりました。これに伴って、データの読み込みも日毎にするため、リンク元データを保存するファイルを日毎に分割しました(従来は月毎でした)。旧データからの変換は自動的に行われます。なお、変換後のデータファイルは「YYYYMM.tdr~」という名前に変更されているので、これは削除してかまいません。

もちろん、編集ページでは従来どおりに見られます。 

### リンク先にのみデータを残すようにした
たとえば、最新の日記が2007年12月27日の時に、他のサイトから2001年1月1日の日記へアクセスがあったとしましょう。

従来のtDiaryでは、このアクセスの記録は20071227(最新日)と20010101の双方に記録されていましたが、2.2以降では、恒久的に残るのは20010101だけになります。20071227に記録されたデータは、日記を更新するに従って最新日に移行されつつ、一定の日数を経ると消えてしまいます。

この「一定の日数」は現在の実装では、最新表示で指定している日数分(tdiary.confにおける@latest_limit)と同じです。つまり、たとえばこれを5日に指定してある場合、過去の日記へのリンクは5日間だけ保持されて6日目には消滅します。

こうして、その日に無関係のデータを保存しないようにすることで、データの肥大化を防いでいます。前日までのリンク元を参照したい場合には、最新の日付のリンク元を確認するようにしてください。

### 一時保存用の設定をできるようにした
本当にアクセスのあった日にだけデータを保存するようにしても、年月を経ることでデータファイルは肥大化してしまいます。その最たる要因は、検索エンジン経由のアクセスです。指定した特定サイトからのアクセスは恒久的には保存せず、翌日には消えてしまうようにすることで、データファイルの肥大化を防ぐことができます。

設定ページの「リンク元」を見ると、「以前の日記へのリンク元に記録するリスト」という項目が増えています。ここに検索エンジンのURLなど、一時的に記録するだけのサイトを羅列しておくことで、これが可能になります。

----

以上のように、従来の使い方だと少し不便になった面もありますが、長く快適に日記をつけることを目的とした改善ですので、ご理解いただきたいと思います。

