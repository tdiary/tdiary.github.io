---
leyout: post
title: 2.0へのデータ移行
---
 1.4までのバイナリファイルに変わって、2.0からは独自のテキスト形式ファイルに変わりました。もちろん従来のバイナリファイルも使えます。ここではバイナリファイルを新しいテキストファイルへ変換する方法と、従来のバイナリファイルを使う方法を説明します。
いずれの場合も、1.4から2.0以降にする場合には、tdiary.confは新しく作り直した方が良いでしょう。指定できる設定がいくつか増えています。

2.0で従来のバイナリファイルを使う方法
tdiary.confで指定をします。tdiary.conf.sampleには、以下のような記述があります。

<pre>
# 日記保存形式の指定【オプション】
#   日記の保存形式を標準から変更する場合には、必要な設定をしなければなり
#   ません。何も指定しない場合にはtDiary2形式(テキスト)になります。
#   何を指定するかは、その保存形式用プログラムの説明に従ってください。
#   以下の2行のコメント(#)をはずすと、tDiary1形式(バイナリ)になります。
#require 'tdiary/pstoreio'
#@io_class = TDiary::PStoreIO
</pre>

新しいtdiary.confで、この最後の2行にある行頭の「#」を削除してやれば、従来のデータがそのまま使えます。

1.4のデータをテキストに変換する方法
misc/convert2.rbというコマンドがあるので、それを使います。tDiaryインストールディレクトリにtdiary.confがあるという前提だと以下のようにすれば変換できます。「apache:apache」の部分は環境に合わせて適宜読み換えてください。

<pre>
% su ←ファイルのパーミッションがWebサーバだと思うのでroot作業を推奨
Password:
# cd (tDiaryのインストールディレクトリ)
# ruby misc/convert2.rb
# cd (データのディレクトリ)
# chown -R apache:apache . ←Webサーバから読み書きできるように
</pre>

なお、tdiary.confが異なる場所にある場合には、-pオプションや-cオプションを指定する必要があります。

<%=ul <<LIST
-p &lt;dir&gt;: tDiaryのインストールディレクトリ
-c &lt;dir&gt;: tdiary.confがあるディレクトリ
LIST
%>

 新形式のファイルは、年ごとのディレクトリの下にYYYYMM.td[2cr]という形式で入っています。.td2は日記本文、.tdcはツッコミ、.tdrはリンク元がそれぞれテキストで月単位にまとまっています。
あとは、(勇気のある人は)旧データ(YYYYMMのファイルとYYYYMM~[バックアップ])を削除してもけっこうです。でも念のため、どこかに残しておきましょう:-) また、テキストファイルの方も、定期的にバックアップをとりましょう。

